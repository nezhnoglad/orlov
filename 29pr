#include <iostream>
#include <cmath>
#include <limits>

using namespace std;

void clearInput() {
    cin.clear();
    cin.ignore(numeric_limits<streamsize>::max(), '\n');
}

int main() {
    setlocale(0, "");

    cout << "Калькулятор с функциями\n";

    char op;
    double x, y;

    while (true) {
        cout << "\nВыберите операцию (q для выхода): ";
        cin >> op;
        if (op == 'q' || op == 'Q') {
            cout << "Выход из программы.\n";
            break;
        }

        
        if (op != '%') {
            cout << "Введите первое число: ";
            cin >> x;
            if (cin.fail()) {
                cout << "Ошибка ввода числа.\n";
                clearInput();
                continue;
            }
        }

        
        if (op == '+' || op == '-' || op == '*' || op == '/' || op == '^' || op == 'r') {
            cout << "Введите второе число: ";
            cin >> y;
            if (cin.fail()) {
                cout << "Ошибка ввода числа.\n";
                clearInput();
                continue;
            }
        }

        switch (op) {
        case '+':
            cout << "[ + ] Результат: " << x << " + " << y << " = " << (x + y) << "\n";
            break;
        case '-':
            cout << "[ - ] Результат: " << x << " - " << y << " = " << (x - y) << "\n";
            break;
        case '*':
            cout << "[ * ] Результат: " << x << " * " << y << " = " << (x * y) << "\n";
            break;
        case '/':
            if (y == 0) cout << "Ошибка: Деление на 0 запрещено!\n";
            else cout << "[ / ] Результат: " << x << " / " << y << " = " << (x / y) << "\n";
            break;
        case '%': {
            int a, b;
            cout << "Введите первое целое число: ";
            cin >> a;
            if (cin.fail()) {
                cout << "Ошибка ввода целого числа.\n";
                clearInput();
                break;
            }
            cout << "Введите второе целое число: ";
            cin >> b;
            if (cin.fail()) {
                cout << "Ошибка ввода целого числа.\n";
                clearInput();
                break;
            }
            if (b == 0) cout << "Ошибка: Деление на 0 запрещено!\n";
            else cout << "[ % ] Результат: " << a << " % " << b << " = " << (a % b) << "\n";

            break;
        }
        case '^':
            cout << "[ ^ ] Результат: " << x << " ^ " << y << " = " << pow(x, y) << "\n";
            break;
        case 'r':
            cout << "Введите степень корня: ";
            cin >> y;
            if (cin.fail()) {
                cout << "Ошибка ввода числа.\n";
                clearInput();
                break;
            }
            if (y == 0) {
                cout << "Ошибка: степень корня не может быть 0!\n";
            }
            else if (x < 0 && (int(y) % 2 == 0)) {
                cout << "Ошибка: корень четной степени из отрицательного числа не определен в действительных числах.\n";
            }
            else {
                cout << "[ r ] Результат: " << y << "-й степени из " << x << " = " << pow(x, 1.0 / y) << "\n";
            }
            break;
        case 'c':
            cout << "[ c ] Результат: куб числа " << x << " = " << x * x * x << "\n";
            break;
        case 's':
            cout << "[ s ] Результат: sin(" << x << ") = " << sin(x) << "\n";
            break;
        case 'k':
            cout << "[ k ] Результат: cos(" << x << ") = " << cos(x) << "\n";
            break;
        default:
            cout << "Ошибка: неизвестная операция!\n";
            break;
        }
    }

    return 0;
}
